<?php

$input = "><<<<>><<><<<<>>>><<><<<>>><<>>>><<<<>>><<<><<<<>>><<<><<<>>>><<<><<<<><>>><>>><<<<><<<>>>><<>>>><<>><<>>><<<<>>><<>><>>><<>>>><<>><<<<><>><<>>>><<<><<<<><<<><><<>>><>><<<>>>><<<><<<<>>>><><<<<>><<<><>><>>><<>>><<<<>>>><<<<><<<<><<<><<><<<<>>>><>><<<<>><<>>><<<>>><><<<>>>><<<>>>><<<>><>><<>><<<>>>><<<<>>>><<<<>><><<<<>>>><><<>>>><<>><<<><<<>><><>>>><>><><<<<>>><<><>><<<>>>><><<><<><>>><<<<>>><>>><<<>>><<<<>><<>>>><>>>><>>>><<<<>>>><<<>>><>>><>>>><<>><<>>>><<<>>><<>>><<>>>><<<<>><<>>><>>><><<>>>><<><>>>><<>>><>><<<>><<>><><<<>>><<<>>>><><>>><<>>><<>>><<<<>>>><>>><<<<>>>><>><<<<>><<<<>>><<>><<>><>>><<<>><<<<>>><<>>>><<>><<<>>><><<>><<><<>><<<<>>>><<<<><>>>><><>>>><<<><><<<><<<<><<><>>>><><<<><<<<>>><>>>><<<<>><>>>><<>><<><><>><<<>>>><<>><<<>>>><<<<>>>><<<><<<>>><<<>><>><<<><<<>><<<<><<<>>><<<><>>><<>>><<<>>>><>><<>>>><<><<<>>><<<>>>><<<<>><<<>><<>><<<><>>><<>>><>>><<>><<>><<<<>>><>>><><<<<><<<<><<>>>><>>>><<>>>><<<<><<<<>><>><<<>>>><<<<>>><<>>>><<<<>>><<>>><<<<><<>>>><><><>>>><<>>>><<><<<>><<<>><<>>>><<>><<><<<<>>>><>><<<>><<<<><<<<>>><<>>><>>><<<<>>>><>><<<>>>><<<<>><>>>><<<>>>><>>><<<<>><<<<>>>><<<<>>><<<>>>><>><>>><<<><><<<>><<<<>>><>><<<>><>>>><<<>>>><<<>>><<<<>>><<<><<<>>><<>>>><<<>>><<<<>><<>>>><<<>><>>>><<>>>><<<<><<<><<>>>><><<<<>>>><<<<><<<<>>><<<>>>><<<<>>>><>><<<<>><<<<>>><><<<>><<<>>><>>>><<<>>><<><><<<<>>><<><<<>><<>>>><<<>><<<<>>><><<<>><<<>>>><<>>><<<>><<<<>>>><>>>><>>>><<<<><<<<>>><<><<>>>><<<<>><><>><<>><<<<>><<<>>>><>>>><<>><<>>><>>>><<<>>>><<<<>><<<>>>><<<<>><<>><<<<>>><<>><>>>><><<<<>>>><<>><<><<><<<>><>>>><<<>>>><<<>>><<<<><<<><>>><<>>><<>><<<>>><>><<<>>><<<>>>><>>><<>>>><<<>>><<><<>>><<>>>><>><<<><<><<<<>>><<<<>><>><<<>>><>><<<<>><<<<>><<>><<<<>>><<<<>>>><<<>>><<<<>>>><<><<>><<<><<<>>>><<<<><<<<>>><>>>><>><<<>>><<><><<>><<<>>>><<<><>>><<<>>><>>>><<><<<>><<<><<<<>><>>><<<>>>><>><<<><><<<>><<>><<<><<<>><<<<>>>><<<<>>><<>>><<<>>><<><<>><<<>>><<>>><<>><<<><>>><>>><<><<><><<>><>><<<><<<<>>><<<>>>><<<<>>>><>><<>>><>><>>>><<<>><<<<>>>><<<<>>><>>>><<<><<<<><<<><<<>>><<>>>><<<>><<<<>>>><<<<>>>><<<><<<<>><>>>><>><<>>>><<<<><<<>>><>>><<>>>><<<><<<<>>><<>><>><<>>><<<>>>><<<>>>><<<>>>><<<<>>><<<<>><><<<><<<>>>><<<>>>><<>><>>><<<><<<>><<<<><<><<><<<<>>><<>>>><<<<>>>><<>>><<<<>>>><<<<>>>><<<<><>><<<>><<><>>>><<<<><<>>>><<><<<>><<<<><<<<>><<>>>><<<>>><<>>>><>><<<<>><<<>><>>><<<<>>>><>>>><<<>><<<<><<>>>><<><>>>><><<>>><<<><<>><<<<><>>>><<<<><><>>>><<<<>>>><>>>><>><<<><>>><><<><<>>><<>>>><<<>>>><<><<<<><<<<><><<<<>>><<<>><<<><<<<>>><>>>><>>><<<><><>>>><>>>><<<>><<<>>>><<<<>>>><<<<><<<<>>>><<<><<><>><>>><>>>><<><<>>>><<<>>><<>>>><<<<>>><<<>>><<<>>><<<>><<>><<><<>>><<>>><<<>>><<<<>>>><>>>><<<>>>><>><>><><<>>><<<>><<<<>>><>><>><<<<>>><>><<>>><<<<>>><>>><>><<<>>>><<<<>>><<>>><>>>><>>>><<><<<<>>><<>><><<<<>><<<<>><<<<>>>><<<<>>>><<<<>>><<<>><<<>>>><<<<>>><>>><>>><>><<<>>><<><<>>><<>>><<<>>><<<<>>><<<>>>><<<>><<>>>><>><<<<>>>><<><<<<>>><<>><<>><>>>><<<>>>><<<>>>><>><<<<><>>><>><<>>><<<>>><<<>><<<>>>><<>>><<<>><<>>>><<<<>><<><<<<>>>><<>>><>>>><<<<><<<<><<><<<>><><<<>>><<<><<<><<<>>><<<<>><<<<>>><<<<>>>><>>><>>>><<<>>><<<<>><<<>>>><<<<>>><<<>><><<>>><<<>>><>>><<>>><<<>><<><<<>>><<>>><<>><<<<><<<>><<<<>>>><<<<>><>>><<<<>><<<><>>>><<>>>><>>><>><<>>>><<<>>>><<>>>><<<<>>><>>><>>><<<<>>>><>>>><>><<>><>><<<>><>><<>>><>>>><<<<>>><>>><<<><<<>>>><><<<>><>>><<<<><<<<><<<<><><<><<><<<><>>>><>><<>>><<<<>>><><<<<>><<<<><<<>>><<<>>>><<>><<<<><><<<>>>><>>><<<<><<<<>>>><>><><<<<>>>><<<<>>><>>><<<>><><<<><<<<>>>><<<<><<<>>><>><<<<>><<<>>>><<>>><<<><>><<>>>><<>>><>>><>>><<>>>><<<<>><>>>><>><<<<>>>><<>><<<>>>><<<<>>>><<>>>><<<>><<<<><<>>><><>>><>><<<<>>><<>><<<>>><<><<<>><<<<>><>>><<<><<>>><<>><<<>>>><<<>><<><<>>><<<><<<<><<<>>><<<><<><>>>><>>>><<<>>>><>><<<><<>>>><><<><<>>>><<<<>><<>>><<<<>>>><>>>><<>><<>><>>><<>><>>>><<<<>><>>><>>><<><>>>><<>><>>><<><><<<>>><>>>><<<>><<<<>>>><<<><<>>><<<<>>>><><<>>><<>><<<>>><<<>>>><>><<<<>>><<>>><>>>><>><<>>>><>>><>>><<>>><>><<<><<><<<<><>>>><<<>>>><>>>><<<<>>>><<<<><<<><<<>>><<<>><<>><<>>><<<>>><<<<>>>><<<>>><<<>>><<<><><<<>>>><>>>><>><<<>><<<>>>><><>>><<<>>>><>>>><<<>><<<<><>>><<<><<<<><<<>>>><<<<>>>><<<>>>><<><<>><>><<<>>><<<>><<<>>>><<<<>>><<<<>>><<<<><<<><<<><<<<>><<><<>>>><<<>>>><><<>><<>>><><<<<>>><<<><<<><<<>>>><<<>>><<<<>>>><<<<>><<<<>>>><><<>>><<><<>>><<><<<<><<<><><<<<><<>>>><>>><<<<>><<<<><<><<<<>>>><<<<>><<<>>>><>>><<<<>>><<<>>>><>>>><<<<>>><<<<>>>><>>><<<<>>><<<><><>>>><>>><<<<>>>><<<<><>><>>><><>><<>>><>>>><<<<><<<>>><<<<>>>><<<<>>>><<<>>><<<>>>><<<>>><<<<>><<><<>>><<<><<><<<<>>><<<<><<>><><<<><>>>><<<<>>>><<<<>>><<<>>><>>>><>><<<><<>>>><<<><<<<>>><<<><<<<>>><<<<>><><<>><<>>><>>><>>><<>>>><<>>>><<>>>><<<<><<<><<<<>>>><<>>>><><<<>><<<<>><<<>><<<>>><>><<>><<<<>>>><<<<>><><<>>>><<<>><<<<>>>><<<><<>>>><<<<>><<>>>><<<<>>>><>>>><>><>>><<<>><<<<>>>><<<>>><<<<><<<<><<><<>><<>><<<><<<<>><<<<><<>>>><<<<><>>>><>>>><>>><<>>>><<>>>><<<>>><<<><<>>>><<<><<<<>><<>>>><<><><<<<><<<><<>>>><<<>>><<<<>><<><<<>><>><<<<><><<<>>>><>><<>>>><<<>>>><<>>>><<<>><>><<>>><<<>>>><<<>>>><<<<>><<>>>><>><<<<>>>><<>><<<<>>><<>>><<><<<>>>><<<<>>><>><<>><<<<>><<<>><>><<>>>><<<>><<>>><<>><<<<>><><<<><<<<>>><<><<<><><<>>><<>><<<<>>><<<>><>><<<<>><<<<><<<<>>>><<<<>>><<>>><>>>><<<<>>><<<><<<<>><>>>><<<>>>><<><>>><<<>>><<<<>>>><<><<<>>>><<>>><<>><<<>><<<>>><<<><><><>><>>>><><>><<<>>>><<<>><<<>>>><<>><<>>><<<>>><<<>><<<<><<<<>>><>><<>><<<<>>>><<>>><<<<>><<<>>>><<<<>><<<<><>>><>>>><<>><<><<<>><<<><<<>><>>>><<<<>><<>>><<>>><<<>>>><>>>><<<<>>><<<><<<<>>><<>>><>><<>><<<>>>><<<<><>><>>><<<<>>>><>>>><<<><>>><<<><<<<>>><<<><<><<<<>><<>><<>>>><<<>>>><<<<>>>><<>><<<<><<<>>><><<<><<<>>><<<>>><><<<>>><<>>><<<<>><<<<>><<>>>><<><<<<>><<<><>>>><<<>>><<<>><<>>>><<<<><<<<>>>><<>>>><>>>><<<>>><<>>>><<<>>>><>>><<<<>>><>>>><>><><<<<>>>><<<>>><><<<><<<>>>><><<>>><<<<>>>><>><<><><<<>>><<<><<<<>>><<>><<<>>>><<<>>><<<<>><<<>><<<><<>>><<<<>>><><<>>><<<>>>><<<<>>>><<<<><<<>><>>>><>>>><<>>><<<>><<<>>>><<>><<>>>><<<><<>><><<><<><<><<<>>><>>>><>><><<<<>><>><>>>><>>><<<<>>>><<<<>>>><>>><<<>><<<<>>><<>>><<<<><<<<>>>><<<<>>>><<><<<>><<>>><<>>><<<>>>><<<<>>>><<<<>>><<>>><<><<<<><<>>>><<><<<<>><<<<>>><<<<>><<<>><<><>>><<>>>><<<<>>><<<<>>>><<<>>><>>><<<<>>>><<<<>>><<><>>><<><<<>><>>>><>>><<<<><<>><<>>>><>>><<<>>>><><<<<>>>><<<<>><<<>><<<><<<<>>><<<<>>><<>><<><<<<>>><><<>>>><<<>><<>><<<<>><<>><<>><<>>><<<<>><<<><<>>><><>>>><<<>>><<<><><<><<<<>>>><<<<>>>><><<<<><>>><<<>>><<<>><<>>>><<>><<<<>>><<><<<<>>>><<<>>>><<<>><<<>>>><>><<>><>><<<>><<><<><<<><<<<>>><>><<<<>><<<>>><<<<>>><<<<>><<<<>><<<<>>><<<<><>><<<><>>>><<>>>><<<<>><<<<>>><<>><>>><>>>><<<>>><>><<<>>><<><<<>>><<>><>>>><>><>><<><>>>><<<>>>><<>>>><<<>>>><<<>>><<<>>><<><<>>>><>>><>><<>>><<<>>><<>><<><<>><<>><<>>>><<>>>><>>><<<>>>><><<<<>><<<>>>><<<><<<<>>><<<<>>>><<>><<<><<<<>>>><><<>>>><>>><<<>>>><<<>>>><<><>><<<>>><<<<>>>><<<<><>>><<<<>><<<<>>><<<<><>>><<<<>><>>>><<<<>>><<>>>><<>>><<<<>>>><>>><><<>>>><<<><>><<<<>>>><<<<>>><<<>>>><<>><<<<>>>><>><<<><>><>>><>>><<>>><<<<>><<<>>>><<<>>><<<>>>><<<<>>><<<<>><<<<>>>><<<>>><>>>><<<>>><<<<><<<<><<>><<<<><<<<>><>><<<<>>>><<>><>>><<<><<>>><<<><<<<>><<<>>>><>>><>><<<>><<<<>>>><<<>>>><<>><>>>><<<<><<>>><<><<>>><>>><<>>><<<<>>><<<<>>><<<<>>><>>><>>>><<<><<<<>><<<>><<>>>><<<<>><<<><<<><>>>><<<>>>><<>>><<>>>><<<><<><<<><<<<>><>>>><<<<>><<><<>>>><<<<>><<<<>>><<<<>><>><<<<>>><>>>><<<<>>>><<>>>><<>>>><>>><<>><>>>><<<<>>><<<<>><>>><<>><<<<><<<>><><<<<>>>><<<<>><>>><<<<>><>>>><<><><<<<>><<<<>>><<<<><><<<>>><<><<<>><<<>>>><>>><>>>><<>>>><<>><<<>>>><>>>><<><<>>>><<><<<<>>>><>>>><<>>><<>>><><<<<>>><<<<>>><<<>><<>><>>>><<><>>><>>><<<<>><<<<>>>><<<>>>><<<<>>>><<<<>>>><<<>><>>>><<<>><<>><>>><>>><<><<<<>>>><<>><<<>>>><<<<><<<<>>>><<<><<<><<<<><<<>>><<<<>>>><<>>>><>><<<<><<>><<<<>>>><<<>>><>>>><<>>>><<<<>>><><>>>><<><>>>><<><<<<><<<><>>>><<><<<>>>><>><<<>>>><<<><>><>>>><<<>>><>>>><<>>>><>>>><<<<><>>>><<><<>><<<<><>>><<<<>>>><<<<><<<<><><<><<<>>><<<<>>>><<<<><<<>><<<<><>><>><<<>><<<<>><<>><<<><<<><<>>><<<<><<>><<<<>>><<>>>><<<<>><<>>>><<<<>>>><<<<>>><<<<><<<>>>><<>>>><<<<>><>>>><<<<><><<><>><<<<><>>>><<<>>><<<>><<<>><<<<>>><<<<>>>><>>>><><<<<>>>><>><>>>><<<>>><<<<><>>>><<>>><<<<><<<>><<<>>><<>>><<<<>>>><<<>>><<<>>>><<>><<>>><<><<<>>><<<<>>><<<>>><<<<>><><>>><<<>><<<<>><<>><><<<<>>><>>>><<<><<<<><<><<<>>><<<>><>>><<<<><<>><<<><<<>>><>><<<<>><>>>><<<>>>><<<><><<>>><>><<>><<<<>><>>>><><<<>>>><<<>><<>>>><<>>>><<>><<<<>><><>>>><<>>>><<<<><>><<><<<<>><<>>>><<<>>><<<>><<<<>><<>>>><>>>><<>>>><<<>>>><<<<><<><<<>>>><<>>>><<<>>><>>>><>><>>>><<<<>><>><><>><<><<<>><<><<<>>><<<<><<<<><<<<>>><<>>>><<<>>><<><>>>><<>>>><<>>><<>>>><<><<<<>><>>>><<<>><<<>>><<<>>>><<>><>>><>><<<>><<<>><<>>><<<><<>><<<<><<<>>>><>>><<<><<<>>>><<<>><>><>>>><>><><<>><<<<>>><<<>><<>><<<>>>><<<<>><<<>><>>>><<<<>>>><>><>><<<<>><<<>>>><<>>><<<<><>>>><<<>>>><<<<><<>>>><<><>><<>>><<<<>><<<<>>><<<<>>>><>>>><<>><<<<>>>><<>>>><<>>><<>>>><<<><<<>>><<>>><<<>><<<>>><<><<<><<<<>>>><<<><<><>>>><<>>><<>>><><<>>><<<<><<<<>>><>><<>>>><<<<>>><<<<><>>>><<<<>>>><>>>><<<>>>><<<<>>>><<<<>>><<<<>><>>><>><<><<<<>>>><>>>><>>>><<<>><>><<<><><<><<<<>><<>>><<<>><<<><<<<><<<>><<<<>><<<<><<>><<<>>><<<<><<>>><>><>>>><<>>>><<<<>>><><<<<>>><>><<<<><<<<>><<<>>><<<<><<><<><<>><<><<>>><>><<<<>>><<<>><<<<>><<<<><<<>>>><>>><><<<>><<><<>><<>>>><<>>><<>>>><<<<>>>><>>>><>>><<>>><<>>>><>>><<><<<<>>><<<>><<<<>><<<>>><<<<>>><<<><<>>>><<<>>>><<<<>><<><>>><<<><<<<>>>><><<>>>><<<>>>><><<>>>><<>>>><<<<>><<<<><<<><<>><>><>><>>><<><>>><<><<>><<<<><<>><<<<>><>><<<<>>><<<<>><<<<>>><<<><>>>><<<>>>><>>>><><>>>><<>><<<<>><>><<<>>>><<>>>><<>>><<<>>>><><>>>><<<>>>><<<<>><<<>><<>>><<><<<>><<<<>>>><<>>>><>>>><<><<>>>><>>>><<<<>><<<<><<>>><><<><<<>>>><><<>><<<>>><>>>><<>>>><><<><<>>><>><>><<<<><<>>>><<<<>><<<<>>><>>>><<<>>><<<<><>>>><<<<>>>><<>>><<>>><<<>><>><<<<><<<<>>>><><<<>><<<<>>>><<><<<>><<<>><<<<>>>><><<><>>>><><<<<>>><<<>>><<>>>><>>>><<<<>><<><<>>>><<<><<<><>>><>>><<>><<<>><><<<<>>><<<<><>>>><<<>><<>><<>><<<>><<<<>>>><<<>><>>>><<>><>><>>><<<>><>><<<<><<<<>>>><<<<>>><<<>>>><<<<>>><<<<>>><<<<>>><<><>>>><<>>>><>>><<>>>><<<>>><<>>><>><<<>>>><>><<>>><<><<>>><<<>>>><<><<><><<<>>><<<>>>><<<>><<<<>><<><<<<>>><>>>><<<<><<>>><<<>>>><<><<<>>><><<>>><<<<><<<>>><>><><<<>>><<<>>>";
//$input = ">>><<><>><<<>><>>><<<>>><<<><<<>><>><<>>";

$input = str_split($input);


$limit = 15000;

$map = array_fill(0, $limit, array_fill(0, 7, "."));

$currentShape = 1;
$shapeHeight = [1=>1, 2=>3, 3 => 3, 4 => 4, 5 => 2];

$i = 0;
$currentFloor = $limit - 3;
$shapeFloor = 0;

//D:151
//Height: 308
//R: 300 D:152
//Height: 460
//R: 400 D:148
//Height: 608
//R: 500 D:153
//Height: 761
//R: 600 D:153
//Height: 914
//R: 700 D:153
//Height: 1067
//R: 800 D:150
//Height: 1217
//
//$diffs = [151, 152, 148, 153, 153, 153, 150]; = sum => 1060
//

//$i = 140;
//$sum = 219;
//while ($i < 1000000000000) {
//    $sum += 106;
//    $i += 70;
//
//}
//
//echo "Rocks: " . $i . "\n";
//echo "Height: " . $sum . "\n";
//readline();


$rocks = 0;
$totalHeight = 0;
$old = 0;
while (true) {
    if (!isset($input[$i])) {
        $i = 0;
    }

    // place the shape position
    $shapeFloor = $currentFloor;
    $height = $shapeHeight[$currentShape];
//    echo $shapeFloor . "\n";
//    echo $height . "\n";
//    echo "CURRENT ShAPE: $currentShape";
    if ($currentShape == 1) {
        $map[$shapeFloor-$height][2] = "@";
        $map[$shapeFloor-$height][3] = "@";
        $map[$shapeFloor-$height][4] = "@";
        $map[$shapeFloor-$height][5] = "@";
    } else if ($currentShape == 2) {
        $map[$shapeFloor-$height][2] = ".";
        $map[$shapeFloor-$height][3] = "@";
        $map[$shapeFloor-$height][4] = ".";
        $map[$shapeFloor-$height+1][2] = "@";
        $map[$shapeFloor-$height+1][3] = "@";
        $map[$shapeFloor-$height+1][4] = "@";
        $map[$shapeFloor-$height+2][2] = ".";
        $map[$shapeFloor-$height+2][3] = "@";
        $map[$shapeFloor-$height+2][4] = ".";
    } else if ($currentShape == 3) {
        $map[$shapeFloor-$height][2] = ".";
        $map[$shapeFloor-$height][3] = ".";
        $map[$shapeFloor-$height][4] = "@";
        $map[$shapeFloor-$height+1][2] = ".";
        $map[$shapeFloor-$height+1][3] = ".";
        $map[$shapeFloor-$height+1][4] = "@";
        $map[$shapeFloor-$height+2][2] = "@";
        $map[$shapeFloor-$height+2][3] = "@";
        $map[$shapeFloor-$height+2][4] = "@";
    } else if ($currentShape == 4) {
        $map[$shapeFloor-$height][2] = "@";
        $map[$shapeFloor-$height+1][2] = "@";
        $map[$shapeFloor-$height+2][2] = "@";
        $map[$shapeFloor-$height+3][2] = "@";
    } else if ($currentShape == 5) {
        $map[$shapeFloor-$height][2] = "@";
        $map[$shapeFloor-$height][3] = "@";
        $map[$shapeFloor-$height+1][2] = "@";
        $map[$shapeFloor-$height+1][3] = "@";
    }


//    readline();
    do {
//        echo "WIND: " . $input[$i];
        if (!isset($input[$i])) {
            $i = 0;
        }
        wind($input[$i], $currentShape);
//        draw();
        $i++;
    } while (drop($currentShape));

    $height = getHeight();
    $currentFloor = count($map) - 3 - $height;
    $rocks += 1;

    if ($rocks == 10000) {
        echo "Rocks: " . $rocks . "\n";
        echo "Height: " . $height . "\n";
        echo "Total Height: " . $totalHeight . "\n";
        echo "TOT: " . ($height + $totalHeight) . "\n";
//        draw();
        break;
    }

    /**
     * To find the cycles, after each rock falls, print the total rock number
     * (total number of rocks fallen), the rock index (so 0-4) , the stream index (the index you're at in the jet stream, so total jets used modulo length of the stream), the resultant height. Run for at least 5 thousand rocks. Filter for rock index 0. It should just pop out at you. Keep in mind there's a beginning period that's not in any cycle, the cycle takes some runs to establish.
     */

    # part 2
    # >>> (1000000000000/1735) * 2720 + 209
    # 1567723342929


//    echo "Rocks: " . $rocks . "\n";
//    echo "Rock Index: " . $i . "\n";
//    echo "Stream index: " . count($input) % $i . "\n";
//    echo "Height: " . $height . "\n";

    if ($rocks % 140 == 0) {
//        echo "Rocks: $rocks\n";
//        echo "Height: $height\n";
        if ($old == 0) {
            $old = $height;
            echo "R: $rocks" .  "\n";
            echo "Height: " . $height."\n";
        } else {
            echo "Diff: " . ($height - $old) . "\n";
            echo "R: $rocks" .  " D:"  . ($height - $old) . "\n";
            echo "Height: " . $height."\n";
            $old = $height;
        }
    }

    // svakih 700 shapeova, height naraste za


    // every 300 rocks, clear the array, and keep only the last row, with height 1
//    if ($rocks % 3000 == 0) {
//        echo "Rocks: $rocks\n";
//        // clear the array
//        $copy = $map;
//        $map = array_fill(0, $limit, array_fill(0, 7, "."));
//        for ($i = $limit - 700, $k = $limit-$height; $i < $limit; $i++, $k++) {
//            for ($j = 0; $j < 7; $j++) {
////                echo "($i, $j, $k)";
//                $map[$i][$j] = $copy[$k][$j];
//            }
//        }
////        var_dump($map[$limit-700]);
////        var_dump($copy[$limit-$height]);
//        $totalHeight += $height - 700;
//    }

//    draw();

    $currentShape = $currentShape % 5;
    $currentShape += 1;
//    readline();
}



function drop($currentShape) {
//    echo "\nBEFORE: \n";
//    draw();
    $moved = false;
    global $map, $shapeHeight, $currentFloor, $shapeFloor;
    $copyMap = $map;
    $height = $shapeHeight[$currentShape];
//    echo "CURRENT FLOOR IN DROP: $currentFloor";
    for ($i = $shapeFloor-1; $i > ($shapeFloor-$height-1); $i--) {
        for ($j = 0; $j < 7; $j++) {
//            echo "($i, $j)";
            if ($map[$i][$j] == "." || $map[$i][$j] == "#") {
                continue;
            }
            if (isset($map[$i+1][$j]) && $map[$i+1][$j] == "." && $map[$i][$j] == "@") {
//                echo "HH\n";
                $map[$i+1][$j] = "@";
                $map[$i][$j] = ".";
                $moved = true;
            } else {
                $map = $copyMap;
//                echo "CONVERTING";
                convertToStone();
                return false;
            }
        }
    }
//    echo "\nAFTER: \n";
//    draw();
    if ($moved) {
        $shapeFloor += 1;
    }
    return true;
}

function wind($direction, $currentShape) {
//    echo "WIND: $direction";
//    draw();
    global $map, $shapeHeight, $shapeFloor;
    $copyMap = $map;
    $height = $shapeHeight[$currentShape];
    if ($direction == "<") {
        for ($i = $shapeFloor-$height; $i < $shapeFloor; $i++) {
            for ($j = 0; $j < 7; $j++) {
                if ($map[$i][$j] == "." || $map[$i][$j] == "#") {
                    continue;
                }
                if ($map[$i][$j] == "@") {
//                    echo "OKOK\n";
//                    echo "($i, $j)\n";
                    if (isset($map[$i][$j-1]) && $map[$i][$j-1] == ".") {
                        $map[$i][$j-1] = "@";
                        $map[$i][$j] = ".";
                    } else {
                        $map = $copyMap;
                        return;
                    }
                }
            }
        }
    } else {
        for ($i = $shapeFloor-$height; $i < $shapeFloor; $i++) {
            for ($j = 6; $j >= 0; $j--) {
                if ($map[$i][$j] == "." || $map[$i][$j] == "#") {
                    continue;
                }
//                echo "($i, $j)";
                if ($map[$i][$j] == "@") {
//                    echo "OKOK";
                    if (isset($map[$i][$j+1]) && $map[$i][$j+1] == ".") {
                        $map[$i][$j+1] = "@";
                        $map[$i][$j] = ".";
                    } else {
                        $map = $copyMap;
                        return;
                    }
                }
            }
        }
    }

//    draw();
}

function draw() {
    global $map;
    for ($i = 0; $i < count($map); $i++) {
        for ($j = 0; $j < 7; $j++) {
            echo $map[$i][$j];
        }
        echo "\n";
    }
    echo "--------------------------------\n";
}

function getHeight() {
    global $map;
    for ($i = 0; $i < count($map); $i++) {
        for ($j = 0; $j < 7; $j++) {
            if ($map[$i][$j] == "#") {
                return count($map) - $i;
            }
        }
    }
    return 0;
}

function convertToStone() {
    global $map;
    for ($i = 0; $i < count($map); $i++) {
        for ($j = 0; $j < 7; $j++) {
            if ($map[$i][$j] == "@") {
                $map[$i][$j] = "#";
            }
        }
    }
    return 0;
}
